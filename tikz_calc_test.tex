\documentclass{article}
%% 3. GEOMETRY AND PAGE LAYOUT
\usepackage[margin=2cm]{geometry}
\usepackage{tikz}
\usetikzlibrary{calc, positioning, shapes}
\usepackage{xcolor}
\usepackage{enumitem}
\usepackage{lmodern}

% Color scheme
\definecolor{primary}{RGB}{41,128,185}
\definecolor{secondary}{RGB}{52,152,219}
\definecolor{accent}{RGB}{231,76,60}
\definecolor{lightgray}{RGB}{250,250,250}
\definecolor{darkgray}{RGB}{100,100,100}

% Counter for timeline events
\newcounter{timelineevent}

% Timeline environment
\newenvironment{timeline}{%
    \setcounter{timelineevent}{0}
    \def\lastbottom{0}% Initialize bottom position tracker
    
    % Calculate dynamic widths based on available space
    \pgfmathsetmacro{\datewidth}{2.3}% Date column width in cm
    \pgfmathsetmacro{\timelinegap}{0.5}% Gap from center to date (left side)
    \pgfmathsetmacro{\eventgap}{1}% Gap from center to event (right side)  
    \pgfmathsetmacro{\timelinethickness}{0.1}% Timeline thickness in cm
    \pgfmathsetmacro{\eventpadding}{0.3}% Internal padding for event box
    \pgfmathsetmacro{\safemargin}{0.2}% Safety margin to prevent overfull boxes
    
    % Calculate available width for event box
    % Total available = \linewidth - date width - gaps - timeline thickness - padding - safety margin
    \pgfmathsetmacro{\availablewidth}{\linewidth/1cm - \datewidth - \timelinegap - \eventgap - \timelinethickness - 2*\eventpadding - \safemargin}
    \pgfmathsetmacro{\eventtextwidth}{\availablewidth - 0.4}% Subtract for borders
    
    % Debug: Show calculated dimensions (uncomment for debugging)
    % \typeout{Timeline Debug: LineWidth=\the\linewidth, Available=\availablewidth cm, TextWidth=\eventtextwidth cm}
    
    % Declare layers before starting tikzpicture
    \pgfdeclarelayer{background}% For timeline
    \pgfdeclarelayer{circles}% For both big and small circles
    \pgfsetlayers{background,circles,main}%
    \begin{tikzpicture}[
        % These styles apply to ALL elements in this tikzpicture
        event/.style={
            rectangle, 
            draw=primary!60, 
            fill=lightgray, 
            thick,
            minimum width=\availablewidth cm,
            text width=\eventtextwidth cm,
            align=left,
            rounded corners=4pt,
            inner sep=\eventpadding cm
        },
        date/.style={
            text width=\datewidth cm,
            align=right,
            anchor=east,
            font=\small\bfseries\color{primary}
        },
        timeline/.style={
            draw=primary!80, 
            thick, 
            line width=2pt
        },
        dot/.style={
            circle,
            fill=primary,
            minimum size=8pt,
            inner sep=0pt
        },
        bigcircle/.style={
            circle,
            draw=primary,
            fill=white,
            thick,
            minimum size=15pt,
            inner sep=0pt
        }
    ]
    % Initialize timeline bounds tracking
    \def\timelinetop{0.8}% Start above first event (using eventspacing value)
    \def\timelinebottom{-0.8}% Will be updated as events are added
}{
    % Draw everything at the end
    \ifnum\thetimelineevent>0%
        % LAYER 1: Draw timeline on background layer (behind everything)
        \begin{pgfonlayer}{background}
            \draw[timeline] (0,\timelinetop) -- (0,\timelinebottom);
        \end{pgfonlayer}
    \fi
    \end{tikzpicture}
}

% Command to add timeline events
\newcommand{\timelineevent}[2]{%
    \stepcounter{timelineevent}%
    % Calculate position based on previous event's bottom plus spacing
    \pgfmathsetmacro{\eventspacing}{0.8}% Spacing between events in cm
    
    % For first event, use initial position; for subsequent events, use last bottom minus spacing
    \ifnum\thetimelineevent=1%
        \pgfmathsetmacro{\ypos}{0}%
    \else%
        \pgfmathsetmacro{\ypos}{\lastbottom - \eventspacing}%
    \fi
    
    \coordinate (pos\thetimelineevent) at (0,\ypos);
    
    % Date/location node (left side) - use calculated gap
    \node[date, anchor=north east] (date\thetimelineevent) at ($(pos\thetimelineevent) + (-\timelinegap,0)$) {#1};
    
    % Content node (right side) - use calculated gap
    \node[event, anchor=north west] (event\thetimelineevent) at ($(pos\thetimelineevent) + (\eventgap,0)$) {#2};
    
    % Draw circles on the circles layer
    \begin{pgfonlayer}{circles}
        % Big circle with white fill covers the timeline
        \node[bigcircle] at (0, 0 |- date\thetimelineevent.center) {};
        % Small dot on top of big circle
        \node[dot] at (0, 0 |- date\thetimelineevent.center) {};
    \end{pgfonlayer}
    
    % Update the bottom position for next event
    % Use the minimum of date and event bottom positions (most negative y-coordinate)
    \coordinate (temp1) at (date\thetimelineevent.south);
    \coordinate (temp2) at (event\thetimelineevent.south);
    \pgfpointanchor{temp1}{center}
    \pgfgetlastxy{\tempx}{\datebottom}
    \pgfpointanchor{temp2}{center} 
    \pgfgetlastxy{\tempx}{\eventbottom}
    \pgfmathsetmacro{\tempbottom}{min(\datebottom/1cm,\eventbottom/1cm)}
    \xdef\lastbottom{\tempbottom}
    
    % Update timeline bottom to extend below the last event
    \pgfmathsetmacro{\newtimelinebottom}{\tempbottom - \eventspacing}
    \xdef\timelinebottom{\newtimelinebottom}
}

\begin{document}

\section*{Professional Timeline}

\begin{timeline}
    \timelineevent{\textbf{June 2010} \\ New York, NY}{
        \textbf{Bachelor's in Computer Science}
        \vspace{0.2em}
        \begin{itemize}[leftmargin=*,topsep=2pt,itemsep=1pt]
            \item Specialized in Software Engineering
            \item GPA\@: 3.8/4.0
            \item Dean's List all semesters
            \item Relevant coursework: Algorithms, Data Structures
        \end{itemize}
    }
    
    \timelineevent{\textbf{May 2014} \\ Boston, MA}{
        \textbf{Research Assistant --- AI Lab}
        \vspace{0.2em}
        \begin{itemize}[leftmargin=*,topsep=2pt,itemsep=1pt]
            \item Machine Learning research project
            \item Published 2 conference papers
            \item Developed novel NLP algorithms
            \item Mentored 3 undergraduate students
        \end{itemize}
    }
    
    \timelineevent{\textbf{August 2015} \\ San Francisco, CA}{
        \textbf{Software Engineer --- Tech Innovations Inc.}
        \vspace{0.2em}
        \begin{itemize}[leftmargin=*,topsep=2pt,itemsep=1pt]
            \item Full-stack web development
            \item Team lead for 3 junior developers
            \item 40\% performance improvement
            \item Agile/Scrum methodology
        \end{itemize}
    }
\end{timeline}

\end{document}